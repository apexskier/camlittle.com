{{ define "preContent" }}
{{if .Params.recipe_link -}}
<b><a href="{{ .Params.recipe_link }}" target="_blank">Recipe{{if .Params.recipe_source }} from {{ .Params.recipe_source }}{{ end }}</a></b>
{{- end }}
{{ end }}

{{ define "postContent" }}
{{ $absRelPermalink := printf "/%s" $.RelPermalink }}
{{ $images := slice -}}
{{ $imageMatches := findRE "src=['\"](.+?)['\"]" .Content -}}
{{ range $imageMatches -}}
{{ $val := strings.TrimLeft $absRelPermalink (substr . 5 (sub (len .) 6)) -}}
{{ with $.Resources.GetMatch $val -}}
{{ $images = $images | append . -}}
{{ end -}}
{{ end -}}
{{ range $images | symdiff .Resources -}}
{{ if eq .MediaType.MainType "image" -}}
	<a href="{{ .RelPermalink }}" class="no-border">
		{{- partial "img" (dict "Resource" . "height" 300) -}}
	</a>
{{- end -}}
{{ if eq .MediaType.MainType "video" -}}
	{{/* safari has some weird bugs with video element styling */}}
	<video controls height="300" style="height: 300px;" alt="{{ .Title }}">
		<source src="{{ .RelPermalink }}" />
	</video>
{{- end -}}
{{- end -}}	
{{ end }}
