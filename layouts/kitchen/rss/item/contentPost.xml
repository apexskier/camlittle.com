{{ $absRelPermalink := printf "/%s" $.RelPermalink -}}
{{ $images := slice -}}
{{ $imageMatches := findRE "src=['\"](.+?)['\"]" .Content -}}
{{ range $imageMatches -}}
{{ $val := strings.TrimLeft $absRelPermalink (substr . 5 (sub (len .) 6)) -}}
{{ with $.Resources.GetMatch $val -}}
{{ $images = $images | append . -}}
{{ end -}}
{{ end -}}
{{ range $images | symdiff .Resources -}}
{{ if eq .MediaType.MainType "image" -}}
  <a href="{{ .RelPermalink | absURL }}">
    {{- replaceRE "(href|src|srcset)=\"/" (printf "$1=\"%s" $.Site.BaseURL) (partial "img" (dict "Resource" . "height" 300)) | safeHTML  -}}
  </a>
{{- end -}}
{{ if eq .MediaType.MainType "video" -}}
  {{/* safari has some weird bugs with video element styling */ -}}
  <video controls height="300" alt="{{ .Title }}">
    <source src="{{ .RelPermalink | absURL }}" />
  </video>
{{- end -}}
{{- end -}}	
